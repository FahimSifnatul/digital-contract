{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Digital Contract - Your secure contract solution!</title>
  <!-- title bar logo -->
  <link rel="shortcut icon" href="{% static 'images/logo.png' %}">
  <meta charset="utf-8">
  
  <!-- Last checked - 25th July, 2021 -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- jquery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!-- popper.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
  <!-- bootstrap 4 css-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
  <!-- bootstrap 4 js-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- custom links & scripts -->
  <script src="{% static 'js/index.js' %}"></script>
</head>

<body>
  
  <!-- navigation bar -->
  <nav class="navbar navbar-expand-sm bg-dark">
    <!-- Logo -->
    <a class="navbar-brand" href="#">
      <img src="{% static 'images/logo.png' %}" alt="logo" width="40">
    </a>

    <!-- Links -->
    <ul class="navbar-nav ml-auto">
      <li class="navbar-item">
        <a class="login" data-toggle="modal" data-target="#modal_signin_signup" href="#">Sign In</a>
      </li>
    </ul>
  </nav>


  <!-- SignIn SignUp Modal -->
  <div class="modal" id="modal_signin_signup">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header border-0">
          <!-- form tabs -->
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#sign_in" id="sign_in_nav_link" >Sign In</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#sign_up" id="sign_up_nav_link">Sign Up</a>
            </li>
          </ul>
          <!-- Close modal button -->
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
          <!-- Tab panes -->
          <div class="tab-content">
            


            <!-- Sign In form -->
            <div class="tab-pane container active" id="sign_in">
              <form id="form_sign_in" method="POST"> {% csrf_token %}

                <!-- User Name -->
                <div class="form-group">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">E-mail</span>
                    </div>
                    <input id="username" class="form-control" type="email" name="username" required>
                  </div>
                </div>

                <!-- Password -->
                <div class="form-group">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">Password</span>
                    </div>
                    <input id="password" class="form-control" type="password" name="password" required>
                  </div>
                </div>

                <!-- To show error message in case of failed login -->
                <div class="form-group">
                  <div id="form_sign_in_error" class="form-control-text alert alert-danger alert-dismissible" style="display: none;">
                  </div>
                </div>

                <!-- Submit -->
                <div class="form-group">
                  <input id="form_sign_in_submit" class="btn btn-primary float-right" type="submit" name="form_sign_in_submit" value="Submit">
                  <div id="form_sign_in_loading" class="spinner-border text-primary float-right" style="display: none;"></div>
                </div>

              </form>
            </div>



            <!-- Sign Up form -->
            <div class="tab-pane container" id="sign_up">
              <form id="form_sign_up" method="POST"> {% csrf_token %}

                <!-- Email -->
                <div class="form-group">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">E-mail</span>
                    </div>
                    <input id="new_username" class="form-control" type="email" name="new_username" required>
                  </div>
                </div>

                <!-- Password -->
                <div class="form-group">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">Password</span>
                    </div>
                    <input id="new_password" class="form-control" type="password" name="new_password" required>
                  </div>
                </div>

                <!-- Confirm Password -->
                <div class="form-group">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">Confirm Password</span>
                    </div>
                    <input id="new_confirm_password" class="form-control" type="password" name="new_confirm_password" required>
                  </div>
                </div>

                <!-- To show error message in case of password mismatch -->
                <div id="form_sign_up_error_parent" class="form-group">
                  <div id="form_sign_up_error" class="form-control-text alert alert-danger alert-dismissible" style="display: none;">
                  </div>
                </div>

                <!-- Submit -->
                <div class="form-group">
                  <input id="form_sign_up_submit" class="btn btn-primary float-right" type="submit" name="form_sign_up_submit" value="Submit">
                  <div id="form_sign_up_loading" class="spinner-border text-primary float-right" style="display: none;"></div>
                </div>

              </form>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

</body>

{% if messages %}
  {% for message in messages %} 
    {% if message.message == "Sign In error" %}
      <script>
        $("#modal_signin_signup").modal('show');

        $("#form_sign_in_error").html("Mismatched username-password or create an account first");
        $("#form_sign_in_error").append("<button type='button' class='close' data-dismiss='alert'>&times;</button>"); 
        $("#form_sign_in_error").show("fast");
      </script>

    {% elif message.message == "User already exists" %}
      <script>
        $("#sign_in_nav_link").removeClass("active");
        $("#sign_up_nav_link").addClass("active");

        $("#sign_in").removeClass("active");
        $("#sign_up").addClass("active");

        $("#modal_signin_signup").modal('show'); 
        $("#form_sign_up_error").html("User with that email already exists");
        $("#form_sign_up_error").append("<button type='button' class='close' data-dismiss='alert'>&times;</button>");
        $("#form_sign_up_error").show("fast");        
      </script>

    {% endif %}
  {% endfor %}
{% endif %}

</html>
